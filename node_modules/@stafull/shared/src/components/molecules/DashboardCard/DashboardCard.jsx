/**
 * DashboardCard Molecule
 * FranchiseOS-compliant card with primary metrics, trends, and interactive elements
 * Follows DESIGN-RULES.md Section 10 (Dashboard Layout System)
 */

import styles from './DashboardCard.module.css';
import { cn } from '../../../utils/cn';
import { Icon } from '../../atoms/Icon';

export function DashboardCard({
  title,
  primaryMetric,
  metricLabel,
  trend,
  trendDirection,
  secondaryMetrics = [],
  progress,
  progressLabel,
  icon,
  iconPaths,
  size = 'medium',
  variant = 'default',
  interactive = true,
  onClick,
  href,
  children,
  className,
}) {
  const cardClasses = cn(
    styles.card,
    styles[`size${size.charAt(0).toUpperCase()}${size.slice(1)}`],
    styles[variant],
    interactive && styles.interactive,
    className
  );

  const content = (
    <>
      {/* Card Header */}
      <div className={styles.header}>
        <span className={styles.title}>{title}</span>
        {icon && (
          <div className={styles.iconWrapper}>
            <Icon name={icon} size="md" iconPaths={iconPaths} />
          </div>
        )}
      </div>

      {/* Primary Metric */}
      {primaryMetric && (
        <div className={styles.metricSection}>
          <span className={styles.primaryMetric}>{primaryMetric}</span>
          {metricLabel && <span className={styles.metricLabel}>{metricLabel}</span>}
          {trend && (
            <span className={cn(styles.trend, styles[`trend${trendDirection}`])}>
              {trendDirection === 'up' ? '↑' : trendDirection === 'down' ? '↓' : ''}
              {trend}
            </span>
          )}
        </div>
      )}

      {/* Secondary Metrics */}
      {secondaryMetrics.length > 0 && (
        <div className={styles.secondaryMetrics}>
          {secondaryMetrics.map((metric) => (
            <div key={metric.label} className={styles.secondaryMetric}>
              <span className={styles.secondaryValue}>{metric.value}</span>
              <span className={styles.secondaryLabel}>{metric.label}</span>
            </div>
          ))}
        </div>
      )}

      {/* Progress Bar */}
      {progress !== undefined && (
        <div className={styles.progressSection}>
          <div className={styles.progressBar}>
            <div
              className={styles.progressFill}
              style={{ width: `${Math.min(100, Math.max(0, progress))}%` }}
            />
          </div>
          {progressLabel && <span className={styles.progressLabel}>{progressLabel}</span>}
        </div>
      )}

      {/* Custom Content */}
      {children && <div className={styles.content}>{children}</div>}
    </>
  );

  if (!interactive) {
    return <div className={cardClasses}>{content}</div>;
  }

  if (href) {
    return (
      <a href={href} className={cardClasses}>
        {content}
      </a>
    );
  }

  if (onClick) {
    return (
      <button type="button" onClick={onClick} className={cardClasses}>
        {content}
      </button>
    );
  }

  return <div className={cardClasses}>{content}</div>;
}

export default DashboardCard;
